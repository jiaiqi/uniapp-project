(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-specific-questionnaire-quiz-quiz"],{"473b":function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"quiz-wrap"},[i("v-uni-view",{staticClass:"quiz-top bg-black"},[t.countdown?i("v-uni-view",{staticClass:"center-countdown text-white"},[i("v-uni-text",{staticClass:"cuIcon-time margin-right-xs"}),t._v(t._s(t.countdown))],1):t._e()],1),"start"===t.contentType?i("v-uni-view",{staticClass:"quiz-center"},[i("v-uni-view",{staticClass:"quiz-title light bg-blue"},[i("v-uni-text",{staticClass:"cuIcon-titles text-blue"}),t._v(t._s(t.formData.title))],1),i("v-uni-view",{staticClass:"quiz-remark"},[i("v-uni-view",{domProps:{innerHTML:t._s(JSON.parse(JSON.stringify(t.formData.remark).replace(/\<img/gi,"<img width=100%  ")))}}),i("v-uni-view",{staticClass:"start-button"},["detail"!==t.formType&&"完成"!==t.formData.user_state?i("v-uni-button",{staticClass:"cu-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.startAnswer.apply(void 0,arguments)}}},[t._v("开始答题")]):t._e(),"detail"===t.formType||"完成"===t.formData.user_state?i("v-uni-button",{staticClass:"cu-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.startAnswer.apply(void 0,arguments)}}},[t._v("查看答题记录")]):t._e()],1)],1)],1):t._e(),"end"===t.contentType?i("v-uni-view",{staticClass:"quiz-center"},[i("v-uni-view",{staticClass:"quiz-title light bg-blue"},[i("v-uni-text",{staticClass:"cuIcon-titles text-blue"}),t._v(t._s(t.formData.title))],1),i("v-uni-view",{staticClass:"quiz-remark"},[i("v-uni-view",{domProps:{innerHTML:t._s(JSON.parse(JSON.stringify(t.formData.end_remark).replace(/\<img/gi,"<img width=100%  ")))}}),"detail"!==t.formType&&"完成"!==t.formData.user_state?i("v-uni-view",{staticClass:"start-button"},[i("v-uni-button",{staticClass:"cu-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitQuiz.apply(void 0,arguments)}}},[t._v("提交")])],1):t._e()],1)],1):t._e(),"question"===t.contentType?i("v-uni-view",{staticClass:"quiz-center"},[i("v-uni-view",{staticClass:"quiz-title light bg-blue"},[i("v-uni-text",{staticClass:"cuIcon-titles text-blue"}),t._v(t._s(t.formData.title))],1),i("v-uni-view",{staticClass:"quiz-question"},[i("v-uni-view",{staticClass:"quiz-question-contetn"},[i("bxform",{ref:"bxform",attrs:{fields:t.currentCols,BxformType:"form",pageType:"add"},on:{"value-blur":function(e){arguments[0]=e=t.$handleEvent(e),t.saveValue.apply(void 0,arguments)}}})],1)],1),i("v-uni-view",{staticClass:"quiz-respond"})],1):t._e(),"question"===t.contentType?i("v-uni-view",{staticClass:"quiz-bottom bg-black"},[0===t.currentQuestion?i("v-uni-view",{staticClass:"left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeQuestion("start")}}},[t._v("返回")]):t._e(),t.currentQuestion>0?i("v-uni-view",{staticClass:"left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeQuestion("pre")}}},[t._v("上一题")]):t._e(),i("v-uni-view",{staticClass:"number"},[t._v(t._s(t.currentQuestion+1)+"/"+t._s(t.formData.item_data.length))]),t.currentQuestion<t.formData.item_data.length-1?i("v-uni-view",{staticClass:"right",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeQuestion("next")}}},[t._v("下一题")]):t._e(),t.currentQuestion===t.formData.item_data.length-1?i("v-uni-view",{staticClass:"right",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeQuestion("end")}}},[t._v("完成")]):t._e()],1):t._e()],1)},o=[]},"642f":function(t,e,i){"use strict";var a=i("f422"),n=i.n(a);n.a},"7d44":function(t,e,i){"use strict";(function(t){var a=i("4ea4");i("99af"),i("4160"),i("d81d"),i("b64b"),i("e25e"),i("ac1f"),i("5319"),i("1276"),i("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("96cf");var n=a(i("1da1")),o=a(i("eaae")),r={components:{bxform:o.default},data:function(){return{starTime:0,timer:null,nowTime:0,total:0,currentQuestion:0,formType:"form",activity_no:"",status:"未开始",configCols:[],quizData:{},formData:{},userInfo:{},wxUserInfo:{},questionData:{},fill_batch_no:"",modalName:null,assessmentReport:[],contentType:"start"}},computed:{currentCols:function(){if(Array.isArray(this.configCols)&&this.configCols.length>0)return[this.configCols[this.currentQuestion]]},countdown:function(){if(this.nowTime){var t=this.nowTime-this.starTime;return parseInt(t/3600)+" 小时 "+parseInt(t%3600/60)+" 分 "+parseInt(t%3600%60)+" 秒"}return"0 小时 0 分 0 秒"}},methods:{changeQuestion:function(e){var i=this.$refs.bxform.getFieldModel();t.log("itemData",i),"pre"===e&&this.currentQuestion>0?this.currentQuestion--:"next"===e&&this.currentQuestion<this.formData.item_data.length?this.currentQuestion++:"start"===e?this.contentType="start":"end"===e&&(this.quizData=i,this.contentType="end")},startAnswer:function(){this.timer||this.start(),this.contentType="question"},submitQuiz:function(){this.submitForm()},hideModal:function(t){this.modalName=null},seeReport:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:uni.navigateTo({url:"/pages/specific/assessmentResult/assessmentResult?activity_no=".concat(t.activity_no,"&fill_batch_no=").concat(t.fill_batch_no)});case 1:case"end":return e.stop()}}),e)})))()},toCreate:function(){uni.redirectTo({url:"/pages/specific/home/home"})},toFeedback:function(){uni.redirectTo({url:"/pages/specific/questionnaire/questionnaire?formType=form&activity_no=20200309125000000100&status=进行中"})},saveValue:function(e){var i=this;if(t.log("saveValue",e,this.status),e.value&&"进行中"===this.status){var a=[{item_no:e.column,option_data:[e.value]}];"checkbox"===e.type&&(a=[{item_no:e.column,option_data:e.value}]),Array.isArray(e.value)&&(a=[{item_no:e.column,option_data:e.value}]);var n="srvdaq_activity_result_save",o=this.getServiceUrl("daq",n,"operate"),r=[{serviceName:n,data:[{activity_no:this.activity_no,item_data:a}]}];this.fill_batch_no&&(r[0].data[0].fill_batch_no=this.fill_batch_no),this.$http.post(o,r).then((function(e){if("SUCCESS"===e.data.state){if("SUCCESS"===e.data.resultCode){t.log(e.data.response[0].response);var a=e.data.response[0].response;a.fill_batch_no&&!i.fill_batch_no&&(i.fill_batch_no=a.fill_batch_no)}}else t.log(e)}))}},submitForm:function(){var e=this,i=e.quizData;!1!==i&&uni.showModal({title:"提示",content:"确认提交?",success:function(a){if(a.confirm)if("进行中"!==e.status)uni.showToast({title:"状态非进行中的问卷不支持提交",icon:"none"});else{t.log("itemData",i);var n=[];Object.keys(i).forEach((function(t){var e={item_no:t,option_data:[i[t]]};Array.isArray(i[t])&&(e.option_data=i[t]),i[t]&&n.push(e)}));var o="srvdaq_activity_result_submit",r=e.getServiceUrl("daq",o,"operate"),s=[{serviceName:o,data:[{fill_batch_no:e.fill_batch_no,activity_no:e.activity_no,item_data:n}]}];t.log("resultData",n),e.$http.post(r,s).then((function(i){"SUCCESS"===i.data.state?"SUCCESS"===i.data.resultCode&&(uni.showToast({title:"提交成功",icon:"none"}),e.formType="detail",e.getQuestionnaireData(e.formData)):("FAILURE"===i.data.resultCode&&uni.showToast({title:i.data.resultMessage,icon:"none"}),t.log(i))}))}else a.cancel&&t.log("用户点击取消")}})},getQuestionnaireData:function(e){var i=this,a="srvdaq_init_view_select",n=this.getServiceUrl("daq",a,"select"),o={serviceName:a,colNames:["*"],order:[{colName:"item_seq",orderType:"asc"}],condition:[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"type",ruleType:"eq",value:"use"}]};"未开始"===this.status&&(o.condition=[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"biz_type",ruleType:"eq",value:"cfg"}]),t.log(this.questionData),e&&e.fill_batch_no&&(o.condition=[{colName:"activity_no",ruleType:"eq",value:e.activity_no},{colName:"type",ruleType:"eq",value:"use"},{colName:"fill_batch_no",ruleType:"eq",value:e.fill_batch_no}]),this.activity_no&&this.fill_batch_no&&(o.condition=[{colName:"activity_no",ruleType:"eq",value:this.activity_no},{colName:"type",ruleType:"eq",value:"use"},{colName:"fill_batch_no",ruleType:"eq",value:this.fill_batch_no}]),this&&this.$http.post(n,o).then((function(e){if("SUCCESS"===e.data.state){var a=e.data.data[0];i.activity_no=a.activity_no;var n=[];a.item_data.forEach((function(t){n.push(i.getConfig(t))})),a.logo&&i.getPicture(a.logo).then((function(t){i.$set(i.formData,"fileUrl",t)})),a.user_data&&(t.log("data.answer_times",a.answer_times),n.forEach((function(e){"detail"===i.formType&&(e.disabled=!0),a.user_data.forEach((function(i){e.column===i.item_no&&(e.item_type_attr&&"multi"===e.item_type_attr.radioType?(e.value=i.option_data,t.log("items.option_data",i.option_data)):(t.log("item_type",e),e.value=i.option_data[0]))}))}))),i.formData=a,"完成"===a.user_state&&(i.formType="detail"),i.configCols=n,i.getUserInfo()}else"0011"===e.data.resultCode?uni.showToast({title:"未登录",icon:"none"}):"FAILURE"===e.data.resultCode&&(uni.showToast({title:e.data.resultMessage,icon:"none"}),"活动已结束"===e.data.resultMessage&&i.updateState().then((function(t){uni.showModal({title:"提示",content:e.data.resultMessage+",即将跳转到列表页面",showCancel:!1,success:function(t){t.confirm&&uni.navigateBack({animationDuration:2e3})}})})))})).catch((function(e){t.log("err",e)}))},updateState:function(t){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var i,a,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=[{status:"已结束"}],a=e.getServiceUrl("daq","srvdaq_activity_cfg_update","operate"),n=[{serviceName:"srvdaq_activity_cfg_update",data:i,condition:[{colName:"activity_no",ruleType:"eq",value:e.activity_no}]}],t.next=5,e.$http.post(a,n);case 5:return o=t.sent,o.data.resultCode,t.abrupt("return",o);case 9:case"end":return t.stop()}}),t)})))()},getUserInfo:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.$api.getUserInfo,a={serviceName:"srvwx_basic_user_info_select",colNames:["*"],condition:[{colName:"app_no",ruleType:"eq",value:t.$api.appNo.wxh5}]},e.next=4,t.$http.post(i,a);case 4:n=e.sent,"SUCCESS"===n.data.state&&n.data.data.length>0?(o=n.data.data[0],t.wxUserInfo=o,uni.setStorageSync("wxUserInfo",o)):uni.showToast({title:"未获取到当前微信用户信息",icon:"none"}),t.getSignature();case 7:case"end":return e.stop()}}),e)})))()},getPicture:function(t){var e=this;return(0,n.default)(regeneratorRuntime.mark((function i(){var a,n,o,r,s,u;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a="srvfile_attachment_select",n=e.getServiceUrl("file",a,"select"),o={serviceName:a,colNames:["*"],condition:[{colName:"file_no",value:t,ruleType:"eq"}]},null===t||""===t||void 0===t){i.next=12;break}return i.next=6,e.$http.post(n,o);case 6:if(r=i.sent,"SUCCESS"!==r.data.state){i.next=12;break}if(s=r.data.data[0],!s){i.next=12;break}return u=e.$api.srvHost+"/file/download?filePath="+s.fileurl,i.abrupt("return",u);case 12:case"end":return i.stop()}}),i)})))()},getConfig:function(t){var e={label:t.item_title,column:t.item_no,srvInfo:{serviceName:"srvdaq_activity_result_submit",appNo:"daq"},value:t.value,type:t.item_type,isRequire:"是"===t.is_require,isShowExp:[],options:[],item_type_attr:t.item_type_attr,display:!0};switch("detail"===this.formType&&(e.disabled=!0),t.item_type){case"文本":e.type="textarea"===t.item_type_attr["view_model"]?"textarea":"input";break;case"图片":e.type="images",e["fileNum"]=t.item_type_attr["fileNum"];break;case"选项":e.type=t.item_type_attr.radioType&&"multi"===t.item_type_attr.radioType?"checkbox":"radio",e.options=t.option_data.map((function(t){return t.option_value}));break;case"时间日期":e.type=t.item_type_attr.dateType?t.item_type_attr.dateType:"dateTime";break;case"数字":e.type=t.item_type_attr.numberType?t.item_type_attr.numberType:"number";break;default:e.type=t.item_type;break}return e},saveShareRecord:function(e){var i=this.$api.saveShareRecord,a=[{serviceName:"srvdaq_record_share_add",data:[{biz_no:this.activity_no,biz_type:"daq",share_url:window.location.href,from_user:this.userInfo.user_no,share_type:e||"朋友圈"}]}];this.$http.post(i,a).then((function(e){t.log(e)}))},getSignature:function(e){var i=this,a=window.location.href.split("#")[0],n={serviceName:"srvwx_app_signature_select",colNames:["*"],condition:[{colName:"app_no",ruleType:"eq",value:this.$api.appNo.wxh5},{colName:"page_url",ruleType:"eq",value:uni.getStorageSync("linkUrl")?uni.getStorageSync("linkUrl"):window.location.href.split("#")[0]}]};uni.getStorageSync("linkUrl")&&t.log("linkUrl",uni.getStorageSync("linkUrl")),uni.setStorageSync("linkUrl",null),i.$http.post(i.$api.getSignature,n).then((function(e){if("SUCCESS"===e.data.state){var n=e.data.data[0];t.log("getSignature",n),uni.setStorageSync("signatureInfo",n),wx.config({debug:!1,appId:n.appId,timestamp:n.timestamp,nonceStr:n.noncestr,signature:n.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData","onMenuShareTimeline","onMenuShareAppMessage"]}),wx.ready((function(){t.log("wx.ready()",i.wxUserInfo),a=a.replace(/formType=detail/,"formType=form"),wx.updateAppMessageShareData({imgUrl:i.wxUserInfo.headimgurl?i.wxUserInfo.headimgurl:i.formData.fileUrl?i.formData.fileUrl:"https://srvms.100xsys.cn:443/file/download?fileNo=20200306184125960100",desc:i.formData.summary,title:i.formData.title,link:a,success:function(){i.saveShareRecord("朋友")},cancel:function(){}}),wx.updateTimelineShareData({imgUrl:i.wxUserInfo.headimgurl?i.wxUserInfo.headimgurl:i.formData.fileUrl?i.formData.fileUrl:"https://srvms.100xsys.cn:443/file/download?fileNo=20200306184125960100",desc:i.formData.summary,title:i.formData.title,link:a,success:function(){i.saveShareRecord("朋友圈")},cancel:function(){}})})),wx.error((function(e){t.log(e)}))}}))},getParams:function(t){var e=window.location.href;e=e.split("?")[1];var i=e.split("&"),a={};return i.forEach((function(t){a[t.split("=")[0]]=t.split("=")[1]})),!!a[t]&&a[t]},start:function(){var t=this;this.timer=setInterval((function(){t.nowTime++}),1e3)},pause:function(){clearInterval(this.timer)},stop:function(){clearInterval(this.timer)},reset:function(){clearInterval(this.timer),this.start()}},mounted:function(){},onLoad:function(e){e.formType&&"detail"===e.formType?this.formType=e.formType:this.formType="form",e.fill_batch_no&&(this.fill_batch_no=e.fill_batch_no);var i=e.questionData;i&&(i=JSON.parse(decodeURIComponent(e.questionData))),i&&i.fill_batch_no?(this.formType="detail",this.questionData=i,this.getQuestionnaireData(this.questionData)):(e.status&&(this.status=decodeURIComponent(e.status),t.log("status",this.status)),e.activity_no?(this.activity_no=e.activity_no,this.getQuestionnaireData()):this.questionData.activity_no?(this.status="已完成",this.activity_no=this.questionData.activity_no,this.getQuestionnaireData()):uni.showModal({title:"提示",content:"未知的问卷编号，即将跳转到问卷列表",showCancel:!1,success:function(t){t.confirm&&uni.reLaunch({url:"/pages/specific/home/home"})}}))},onShow:function(){},beforeDestroy:function(){clearInterval(this.timer)}};e.default=r}).call(this,i("5a52")["default"])},"971a":function(t,e,i){"use strict";i.r(e);var a=i("473b"),n=i("cb87");for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("642f");var r,s=i("f0c5"),u=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"15f01e4d",null,!1,a["a"],r);e["default"]=u.exports},cb87:function(t,e,i){"use strict";i.r(e);var a=i("7d44"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},e9ce:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 引入uview样式 */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.quiz-wrap[data-v-15f01e4d]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;height:100vh;max-width:1000px;margin:0 auto}.quiz-wrap .quiz-top[data-v-15f01e4d]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;height:%?100?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.quiz-wrap .quiz-center[data-v-15f01e4d]{-webkit-box-flex:1;-webkit-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.quiz-wrap .quiz-center .quiz-title[data-v-15f01e4d]{line-height:%?80?%;text-indent:%?20?%;font-weight:600}.quiz-wrap .quiz-center .quiz-question[data-v-15f01e4d]{-webkit-box-flex:1;-webkit-flex:1;flex:1;background-color:#fff}.quiz-wrap .quiz-center .quiz-question .quiz-question-title[data-v-15f01e4d]{margin:%?10?% 0;padding:%?10?% %?20?%;background-color:#fff}.quiz-wrap .quiz-center .quiz-remark[data-v-15f01e4d]{width:95%;height:auto;margin:0 auto;-webkit-box-flex:1;-webkit-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.quiz-wrap .quiz-center .start-button[data-v-15f01e4d]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;min-height:%?300?%}.quiz-wrap .quiz-center .start-button .cu-btn[data-v-15f01e4d]{width:%?300?%;background-color:#333;color:#eee}.quiz-wrap .quiz-bottom[data-v-15f01e4d]{height:%?80?%;display:-webkit-box;display:-webkit-flex;display:flex;color:#eee;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-justify-content:space-around;justify-content:space-around;padding:0 %?100?%}',""]),t.exports=e},f422:function(t,e,i){var a=i("e9ce");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("4efee53e",a,!0,{sourceMap:!1,shadowMode:!1})}}]);